In general, in order to implement a Stripe Checkout flow for an application fee, I'd create a new payment_requests row in the database upon the user starting the payment process. This will store the user ID, the purpose, the amount, and an initial status, say pending. After creating the record, I call Stripe's API to create a Checkout Session, passing in the application fee amount, metadata containing the payment_request_id, and success/cancel URLs. Once Stripe returns the session, I store the checkout_session_id and payment_intent_id in the same database row, so I can track the payment lifecycle.

I then depend on Stripe webhooks, notably checkout.session.completed and payment_intent.succeeded, to confirm the actual completion of the payment by Stripe. The handler for the webhooks looks up in metadata or session ID the associated entry within payment_requests and updates the record's status to paid, storing Stripe's event IDs for auditability. Upon success of the payment, I trigger an update in the main application workflow, e.g., marking that the application was submitted or unlocking next steps for the user. This makes the system fully reliable, even if the frontend closes or the user loses internet during payment.